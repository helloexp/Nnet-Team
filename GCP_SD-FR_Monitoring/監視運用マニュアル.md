### GCP StackDriver 監視運用マニュアル

目次

1. 特記事項
2. サーバ一覧
3. 対応方法
4. インスタンスの再起動方法
5. 緊急連絡先

### 1. 特記事項

* アラートは全てslackでクライアントへ通知されます。
「対応不要」になっているものはslackでのクライアント通知のみなのでnnetでは対応不要となります。

* アラート即時復旧でもご連絡が必要です。
　　また、アラートが検知、復旧を繰り返す場合は継続監視OKですので下記リンクを参照してください。<br>
[継続監視を行いたい場合:](http://192.168.1.20:81/index.php/Phase2%E6%A1%88%E4%BB%B6%E3%81%A7%E7%B6%99%E7%B6%9A%E7%9B%A3%E8%A6%96%E3%82%92%E8%A1%8C%E3%81%84%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88)

* 監視削除の際の注意事項
   * 監視設定削除の際ポリシー確認を忘れないようにして下さい。
   * 削除になったサーバについて、連絡中のアラートがあれば「監視削除となりましたので本件クローズ」の連絡をして下さい。


### 2. サーバ一覧
------

監視サーバ: Stackdriver monitoring (https://app.google.stackdriver.com/)

|タイプ|サーバ名|Local IP||サーバ情報|PASSWD|備考|
|:-----:|:------:|:-----:|:------:|:-----:|:-----:|
|GCE|対象インスタンス名|0.0.0.0|-|PASSWD|-|	
|GCE|対象インスタンス名|0.0.0.0|-|PASSWD|-|	
|GCE|対象インスタンス名|0.0.0.0|-|PASSWD|-|	
|GCLB|対象インスタンス名|-|-|-|-|	
|GCLB|対象インスタンス名|-|-|-|-|	
|GCLB|対象インスタンス名|-|-|-|-|	
|AppEngMemcache|対象インスタンス名|-|-|-|-|	
|AppEngMemcache|対象インスタンス名|-|-|-|-|	
|GCBigtable|対象インスタンス名|0.0.0.0|-|-|-|	
|GCBigtable|対象インスタンス名|0.0.0.0|-|-|-|	
|BigQuery|対象インスタンス名|0.0.0.0|-|-|-|	
|BigQuery|対象インスタンス名|0.0.0.0|-|-|-|	
|GCloud SQL|対象インスタンス名|0.0.0.0|-|-|-|	
|GCloud SQL|対象インスタンス名|0.0.0.0|-|-|-|	
|GCloud Pub/Sub|対象インスタンス名|-|-|-|-|	
|GCloud Pub/Sub(SQS)|対象インスタンス名|-|-|-|-|

### 3. 対応方法
---------

■ GCE監視

|監視項目|Warning|Critical 一次対応|手動確認方法|備考|
|:--------:|:--------:|:--------:|:-------:|:-------:|
|LOAD|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>※原因プロセスの記載は不要<br><br>②メール連絡後下記条件に当てはまる場合は電話連絡<br>============<br>条件①：最初のアラートメール(1)受信時刻より、30分以内に再度同アラートを検知した場合<br>条件②：アラートメール(2)を受信した場合<br>============<br>③電話連絡を実施した場合は、①のメールのレスにて○○様へ電話連絡を実施した旨メール|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>※原因プロセスの記載は不要<br><br>②電話連絡|SD上ではResources Check|-|
|CPU-Utilization,<br>DISK-/,<br>Freeable-Usage Memory,<br>Swap-Usage|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>※原因プロセスの記載は不要<br><br>②電話連絡|SD上ではResources Check|-|
|PROCS-CROND|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|
|PROCS-SSH|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|
|PROCS-SYSLOGD|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|
|StatusCheckFailed-Instance|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|
|StatusCheckFailed-System|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|
|LOG-httpd|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br>※注意点③　ログの内容が「File does not exist」の場合は対応不要<br><br>■対応方法<br>ログの内容をメール連絡<br>cat /home/nnet/script/log-check/httpd/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/httpd/error_log<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/httpd/NGWRD-file<br>※lockファイルは生成されません|SD上ではResources Check|-|
|LOG-boot|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>ログの内容をメール連絡の上、電話連絡<br>cat /home/nnet/script/log-check/boot/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/boot.log<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/boot/NGWRD-file<br>※lockファイルは生成されません|SD上ではResources Check|-|
|LOG-cron|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>ログの内容をメール連絡の上、電話連絡<br>cat /home/nnet/script/log-check/cron/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/cron<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/cron/NGWRD-file<br>※lockファイルは生成されません|SD上ではResources Check|-|
|LOG-messages|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br>※注意点③検知対象のログが「ldap」に関するログだった場合は連絡不要！！<br><br>■対応方法<br>ログの内容をメール連絡の上、電話連絡<br>cat /home/nnet/script/log-check/messages/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/messages<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/messages/NGWRD-file<br>※lockファイルは生成されません|SD上ではResources Check|-|
|LOG-mail|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br>※注意点③検知対象のログが「ldap」に関するログだった場合は連絡不要！！<br><br>■対応方法<br>ログの内容をメール連絡<br>cat /home/nnet/script/log-check/maillog/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/maillog<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/maillog/NGWRD-file<br>※lockファイルは生成されません<br>■電話連絡<br>不要|SD上ではResources Check|-|
|LOG-secure|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br>※注意点③　直近にautoscale addのメールがあり、その本文のIPとアラート検知のサーバIPが合致する場合はack実施しクライアント連絡不要。Ackの後に復旧後は通常対応</B><br>◇autoscal addのメール件名の例：<br>サーバ名 AutoScale server is added!<br><br>■対応方法<br>ログの内容をメール連絡の上、電話連絡<br>cat /home/nnet/script/log-check/secure/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/secure<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/secure/NGWRD-file<br>※lockファイルは生成されません|SD上ではResources Check|-|
|LOG-spooler|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>ログの内容をメール連絡の上、電話連絡<br>cat /home/nnet/script/log-check/spooler/ANS-file<br>※エラー内容が抽出されているので該当のエラー内容を監視対象ログにて確認してください<br><br>■監視対象ログ<br>/var/log/spooler<br><br>■監視対象文字列<br>※下記ファイルを参照して下さい<br>/home/nnet/script/log-check/spooler/NGWRD-file<br>※lockファイルは生成されません|SD上ではResources Check|-|
|PROCS-Nginx|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|
|PROCS-mySQL|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|

■ GCLB監視

|監視項目|Warning|Critical 一次対応|手動確認方法|
|:--------:|:--------:|:--------:|:-------:|
|BackendConnectionErrors、<br>Request count、<br>HTTPCode-Backend-5XX、<br>HealthyHostCount、<br>UnHealthyHostCount|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡及び電話連絡|SD上ではResources Check|
|Total & Backend Latency|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②メール連絡後下記条件に当てはまる場合は電話連絡<br>============<br>条件①：最初のアラートメール(1)受信時刻より、30分以内に再度同アラートを検知した場合<br>条件②：アラートメール(2)を受信した場合<br>============<br>③電話連絡を実施した場合は、①のメールのレスにて○○様へ電話連絡を実施した旨メール|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡及び電話連絡|SD上ではResources Check|

■ AppEngineMemcache監視

|監視項目|Warning|Critical 一次対応|手動確認方法|
|:--------:|:--------:|:--------:|:-------:|
|CPU-Usage、<br>Freeable-Memory|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡及び電話連絡|SD上ではResources Check|

■ Cloud SQL監視

|監視項目|Warning|Critical 一次対応|手動確認方法|
|:--------:|:--------:|:--------:|:-------:|
|CPU-Utilization、<br>FreeStorageSpace、<br>FreeableMemory、<br>Health-check、<br>Disk-Utilization|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡及び電話連絡|SD上ではResources Check|

■ Cloud Pub/Sub監視

|監視項目|Warning|Critical 一次対応|手動確認方法|備考|
|:--------:|:--------:|:--------:|:-------:|:-------:|
|Publish Message Operations<br>Publish Request Internal Error Count|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②メール連絡後下記条件に当てはまる場合は電話連絡<br>============<br>条件①：最初のアラートメール(1)受信時刻より、30分以内に再度同アラートを検知した場合<br>条件②：アラートメール(2)を受信した場合<br>============<br>③電話連絡を実施した場合は、①のメールのレスにて○○様へ電話連絡を実施した旨メール|SD上ではResources Check|-|

■ Cloud Pub/Sub(SQS)監視

|監視項目|Warning|Critical 一次対応|手動確認方法|備考|
|:--------:|:--------:|:--------:|:-------:|:-------:|
|num_undelivered_messages|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②メール連絡後下記条件に当てはまる場合は電話連絡<br>============<br>条件①：最初のアラートメール(1)受信時刻より、30分以内に再度同アラートを検知した場合<br>条件②：アラートメール(2)を受信した場合<br>============<br>③電話連絡を実施した場合は、①のメールのレスにて○○様へ電話連絡を実施した旨メール|SD上ではResources Check|-|

■ Cloud Bigtable監視

|監視項目|Warning|Critical 一次対応|手動確認方法|備考|
|:--------:|:--------:|:--------:|:-------:|:-------:|
|server/error_count|対応不要|■注意点<br>※注意点①　即時復旧でもメール連絡が必要<br>※注意点②　復旧連絡は不要。即時復旧の場合でも、現在は復旧済の文言記載も不要<br><br>■対応方法<br>①メール連絡<br>②メール連絡後下記条件に当てはまる場合は電話連絡<br>============<br>条件①：最初のアラートメール(1)受信時刻より、30分以内に再度同アラートを検知した場合<br>条件②：アラートメール(2)を受信した場合<br>============<br>③電話連絡を実施した場合は、①のメールのレスにて○○様へ電話連絡を実施した旨メール|SD上ではResources Check|-|

■ 個別監視項目

|監視項目|Warning|Critical|手動確認方法|備考|
|:-------:|:------:|:-------:|:-----:|:----:|
|項目名|対応不要|■対応方法<br>①メール連絡<br>②電話連絡|SD上ではResources Check|-|

### 4. インスタンスの再起動方法
------

■ インスタンスをリセットする:

インスタンスでリセットを実行することは、コンピュータのリセットボタンを押すのに似ており、強制的に再起動してマシンのメモリの内容をワイプし、仮想マシンを最初の状態にリセット。リセット中、インスタンスは RUNNING モードのままなので注意点。<br>

■ 停止されたインスタンスを再起動する:

instances().start メソッドを使用して、停止されたインスタンスを元の設定で再起動できる。このメソッドは、現在 TERMINATED 状態で電源を停止している仮想マシン インスタンスを起動です。<br>
※ start メソッドの使用は、reset() 再起動のメソッドとは異なります。これは、TERMINATED 状態のインスタンスを再起動するのに対し、reset() や インスタンス内からsudo reboot などのメソッドは、現在動作中のインスタンスでのみ機能するためです。

### 5. 緊急連絡先
------

メール記載の内容は下記テンプレートを参照し、日本語と英語の両方で記載すること<br>
Send email to person in project charge found from contact list in triage sheet 
by using Japanese and English email template.<br>
[FR-JP&ENG メールテンプレート:](http://192.168.1.20:81/index.php/FR_%E3%83%A1%E3%83%BC%E3%83%AB%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88)

FR案件連絡先一覧参照：

■ メール連絡先:

To: <br>
Cc: <br>

■ 電話連絡先: 

||担当者名|電話番号|
|:-----:|:-----:|:----:|
|1|-|-|	 
|2|-|-|
|3|-|-|

----------------------------------




